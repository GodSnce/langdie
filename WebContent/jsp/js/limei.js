(function(){var default_key_list=["limeibidid","udid","did","appid"],uuid_value=null,click_tag=["BUTTON","INPUT","TEXTAREA","A"],limei_data={},w=window,d=document,lm=w.LiMeiTrackObject||"lm",is_miss=false,c=false,j=false,cd={},eq="eq",start_date=new Date(),time_out=500,ls=false,click=true,debug=false,UA=navigator.userAgent.toLowerCase(),scroll_end=false,second=false,device=null,onload=false;try{device=(UA.indexOf("ipad")>0)?"ipad":(UA.indexOf("iphone")>0)?"iphone":"unknow";c=console;j=JSON}catch(e){}var event=function(){this.need_send=false;this.async=true};var ajax={jsonp:function(options){options=options||{};if(!options.url||!options.callback){throw new Error("参数不合法")}var callbackName=("jsonp_"+Math.random()).replace(".","");var oHead=document.getElementsByTagName("head")[0];options.data[options.callback]=callbackName;var params=ajax.formatParams(options.data);var oS=document.createElement("script");oHead.appendChild(oS);window[callbackName]=function(json){oHead.removeChild(oS);clearTimeout(oS.timer);window[callbackName]=null;options.success&&options.success(json)};var str="/";oS.src=options.url+str+"data.php?"+params;if(options.time){oS.timer=setTimeout(function(){window[callbackName]=null;oHead.removeChild(oS);options.fail&&options.fail({message:"超时"})},time)}},formatParams:function(data){var arr=[];for(var name in data){arr.push(encodeURIComponent(name)+"="+encodeURIComponent(data[name]))}return arr.join("&")}};event.prototype={access:function(){this.need_send=true;var p1=getQueryKey("p1");if(!!p1){return{p1:p1}}},load:function(){if(!onload){this.need_send=true;onload=true}else{this.need_send=false}},click:function(event){debug&&c&&c.log(event);var target=event.target;if(target){this.need_send=true;return{sec:(new Date-start_date)/1000,t:target.tagName,n:target.name,c:target.className}}},submit:function(data){var str="";for(var i in data){str+=i+","+data[i]+","}this.need_send=true;this.async=false;return{submit:str.substring(0,str.length-1)}},scroll:function(event){if(scroll_end){return}var top=d.body.scrollTop||d.documentElement.scrollTop;var dh=d.documentElement.clientHeight;var height=dh&&w.innerHeight!=dh?dh:d.body.clientHeight;if(top*2>height){this.need_send=true;scroll_end=true;return{sec:(new Date-start_date)/1000}}},event:function(action,label,value){this.need_send=true;this.async=false;var data={};if(action){data.a=action}if(label){data.l=label}if(value){data.v=value}return data}};var e=new event();var f=function(){return f.apply(arguments)};f.apply=function(arg){var data=[];extend(data,arg);return actionEvent(data,e)};f.id=function(){if(!uuid_value){uuid_value=uuid()}return uuid_value};var init=function(){cd={domain:getTopDomain(),expires:new Date((new Date).getTime()+15552000000),path:"/"};for(var i=0;i<default_key_list.length;i++){var param=default_key_list[i];var value=getQueryKey(param);if(!value){value=ls?localSave(param):cookie(param)}if(!value){value=getQueryKey(param,getReferrer())}if(!value){is_miss=true}else{is_miss=false;ls?localSave(param,value):cookie(param,value,cd)}limei_data[param]=value?value:""}if(is_miss==true){ajax.jsonp({url:"http://cm.ljrtb.cn",type:"GET",dataType:"jsonp",callback:"process",data:{lm_eq:"c"},success:function(response,xml){limei_data.did=limei_data.did?limei_data.did:response.eq;limei_data.limeibidid=limei_data.limeibidid?limei_data.limeibidid:response.cm;if(response.eq&&response.cm){delCookie("did");delCookie("limeibidid");delCookie("limeiUid");cookie("did",response.eq);cookie("limeibidid",response.cm);var exp=new Date();cookieTime={domain:getTopDomain(),expires:new Date(exp.getTime()+60*5000),path:"/"};cookie("limeiUid",response.cd,cookieTime);limei_data.did=response.eq;limei_data.limeibidid=response.cm}if(!limei_data.did){limei_data.did=cookie("did")}if(!limei_data.limeibidid){limei_data.limeibidid=cookie("limeibidid")}f("access")}})}if(click){addEvent(d,"click",function(event){f("click",event)})}addEvent(w,"scroll",function(event){f("scroll",event)});addEvent(w,"load",function(event){f("load",event)});sendSecond()},extend=function(a,b){for(var c in b){b.hasOwnProperty(c)&&(a[c]=b[c])}return a},contain=function(obj,a){for(var i=0;i<a.length;i++){if(a[i]===obj){return true}}return false},toJson=j&&j.stringify||function(obj){var t=typeof(obj);if(t!="object"||obj===null){if(t=="string"){obj='"'+obj+'"'}return String(obj)}else{var n,v,json=[],arr=(obj&&obj.constructor==Array);for(n in obj){v=obj[n];t=typeof(v);if(t=="string"){v='"'+v+'"'}else{if(t=="object"&&v!==null){v=toJson(v)}}json.push((arr?"":'"'+n+'":')+String(v))}return(arr?"[":"{")+String(json)+(arr?"]":"}")}},parseJson=j&&j.parse||function(string){return eval("("+string.replace("=","").replace("function","")+")")},getReferrer=function(){var a="";try{a=d.referrer}catch(b){}return a},addEvent=function(elm,eventType,handler){elm=typeof elm=="string"?d.getElementById(elm):elm;if(elm.attachEvent){elm.attachEvent("on"+eventType,handler)}else{if(elm.addEventListener){elm.addEventListener(eventType,handler,false)
}else{return false}}return true},actionEvent=function(info,_event){if(info.length<1){return false}var e=info.shift();resetEvent(_event);var result=event.prototype[e]&&event.prototype[e].apply(_event,info);if(_event.need_send){info.unshift(e);if(!_event.async){saveSecond(info)}var obj=send(e,result)}return true},resetEvent=function(_event){_event.need_send=false;_event.async=true},saveSecond=function(info){if(!second){return}var event_queue=decodeURI(cookie(eq));var j=toJson(info);if(!event_queue||event_queue.length==0){j="["+j+"]"}else{j=event_queue.substring(0,event_queue.length-1)+","+j+"]"}cookie(eq,encodeURI(j),cd)},sendSecond=function(){var event_queue=decodeURI(cookie(eq));if(!event_queue||event_queue.length==0){return}if(event_queue[0]!="["){return cookie(eq,"",cd)}event_queue=parseJson(event_queue);if(event_queue.length==0){return}for(var i in event_queue){f.apply(event_queue[i])}cookie(eq,"",cd);second=true},getQueryKey=function(key,url){var rs=new RegExp("([\\?&])"+key+"=([^\\&]*)(\\&|$)","gi").exec(url?url:w.location.href),tmp;if(tmp=rs){return decodeURIComponent(tmp[2])}return null},generateQuery=function(data,flag){var str="";for(var i in data){str+=i+"="+(flag?encodeURIComponent(data[i]):data[i])+"&"}return str.substring(0,str.length-1)},send=function(action,params){if(typeof(params)=="undefined"){params={}}var data={limeibidid:limei_data.limeibidid,did:limei_data.did?limei_data.did:limei_data.udid,appId:limei_data.appid};var extParams=cookie("limeiUid")?cookie("limeiUid"):"";var param={EVENTS:action,p:toJson(params),limeiUid:extParams};debug&&c&&c.log(data,param);var url=getServerUrl()+"?"+generateQuery(data,false)+"&"+generateQuery(param,true);var img=new Image();img.src=url;return img},getServerUrl=function(){return getBaseUrl()+"/"},getBaseUrl=function(){return(w.location.protocol==="https:"?"https://":"http://")+"v.bid.ljrtb.cn/vv"},getTopDomain=function(){for(var b=w.location.hostname.split("."),c=/com|edu|gov|int|mil|net|org|biz|info|pro|name|museum|coop|aero|xxx|idv/,d=b.length-1,f=b.length-1,e=0;d>-1;d--){if(c.test(b[d])){f=d;break}else{/\d+/.test(b[d])&&e++}}b.length==e&&(f=1);return b.slice(f-1).join(".")},cookie=function(key,value,dict){var ck="lm_"+key;if(arguments.length<=1){var rs=new RegExp("(^|(;\\s))"+ck+"=([^;]*);?").exec(d.cookie),tmp;if(tmp=rs){return tmp[0]?decodeURIComponent(tmp[3]):null}return null}if(value===null){value="",dict=dict||{},dict.expires=-1}ck=ck+"="+value;dict&&(dict.path&&(ck+="; path="+dict.path),dict.expires instanceof Date&&(ck+="; expires="+dict.expires.toGMTString()),dict.domain&&(ck+="; domain="+dict.domain),dict.secure&&(key+="; secure"));d.cookie=ck;return true},delCookie=function(name){var exp=new Date();exp.setTime(exp.getTime()-1);var cval=getCookie(name);if(cval!=null){document.cookie=name+"="+cval+";expires="+exp.toGMTString()}},getCookie=function(name){var arr,reg=new RegExp("(^| )"+name+"=([^;]*)(;|$)");if(arr=document.cookie.match(reg)){return unescape(arr[2])}else{return null}},localSave=function(key,value){if(arguments.length<=1){return w.localStorage.getItem(key)}else{if(device=="ipad"||device=="iphone"){return w.localStorage.removeItem(key)&&w.localStorage.setItem(key,value)}else{return w.localStorage.setItem(key,value)}}},randMath=function(){var b=new Array(16);for(var i=0,r;i<16;i++){if((i&3)==0){r=Math.random()*4294967296}b[i]=r>>>((i&3)<<3)&255}return b},uuidParse=function(buf,offset){var _byteToHex=[];var _hexToByte={};for(var i=0;i<256;i++){_byteToHex[i]=(i+256).toString(16).substr(1);_hexToByte[_byteToHex[i]]=i}var i=offset||0,bth=_byteToHex;return bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]+bth[buf[i++]]},uuid=function(){var rnds=randMath();rnds[6]=(rnds[6]&15)|64;rnds[8]=(rnds[8]&63)|128;var id=uuidParse(rnds);debug&&c&&c.log(id);return id};(function(){var queue=w[lm].q||[];start_date=w[lm].l;debug=w[lm].d;init();if(queue.length){for(var i in queue){f.apply(queue[i])}}else{w[lm]=f}})()})();